language: php
php:
  #- '5.5'
  - '7.0'
services:
  - docker

before_install:

  # Add our SSH key for deploy func
  openssl aes-256-cbc -K $encrypted_38df744560e6_key -iv $encrypted_38df744560e6_iv -in travis.id_rsa.enc -out $HOME/.ssh/travis.id_rsa -d

install:

  # Install composer deps
  - composer install

script:

  # Run code and styling
  - composer test

after_success:

  # Set up the SSH key and config
  - chmod 600 $HOME/.ssh/travis.id_rsa
  - eval "$(ssh-agent)"
  - ssh-add $HOME/.ssh/travis.id_rsa
  - cp -rf ssh-config $HOME/.ssh/config

  # Set a user for things
  - git config --global user.name "Travis Bot"
  - git config --global user.email "geoff@thinktandem.io"

  # Set up our repos
  - git remote add upstream ssh://gff@50.116.33.219/var/www/githook-workflow-demo

  # Add production server to known_hosts
  - echo 50.116.33.219 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDdTpRoh/uzu0DEs0AWfqacOqmh1M5YoZV0s3p3RUTLCqdg1IfApyjUKPxI9sNKzECbwqC9BuareXIh9A8UR04iFPUqr7VaLbUpq5ijIMl4BGEVZARautdUiY22    3PjoOEchIhJgC2GZG5caWpcWE9Q5P2x3GJg4MxYwnOOE/QBswwmuocoOnbX/NbrH0DNLW/yggoUAM8J2BU9TmYHaSbj2FhxEvePSC94o8sTKkiwjfkm4ikj6HtaHaJOj0re4lL/oY47lXE5S1vo3iQyDw5KjkM6wqP0SwR5f/xKcGvLIO2XfW6cEpbfLHg6Krfj0KfiFG/jhFWDcnMHKR4Zjb/vL >> $HOME/.ssh/known_hosts

  # We need to re-add this in because our clone was originally read-only
  - git remote rm origin
  - git remote add origin git@github.com:thinktandem/githook-workflow-demo.git
  - git checkout $TRAVIS_BRANCH

  # Pull in any remote changes
  - git pull upstream $TRAVIS_BRANCH

  # And then deploy
  - git push upstream $TRAVIS_BRANCH
